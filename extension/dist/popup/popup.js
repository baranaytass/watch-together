(()=>{"use strict";const e="http://localhost:3000/api";document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("detectButton"),s=document.getElementById("startButton"),n=document.getElementById("status"),o=document.getElementById("sessionUrlContainer"),r=document.getElementById("sessionUrl"),i=document.getElementById("copyButton");let c=null;const a=(e,t)=>{n.textContent=e,n.className=t,n.style.display="block"};t.addEventListener("click",(async()=>{try{const[o]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!o.url)throw new Error("No URL found");c=o.url,t.disabled=!0,a("Checking provider...","info"),new URL(o.url).hostname;const r=await fetch(`${e}/providers/check?url=${encodeURIComponent(o.url)}`),i=await r.json();if(!i.success)throw new Error(i.error?.message||"Failed to check provider");i.isSupported?(n.style.display="none",n.className="",s.style.display="flex",t.style.display="none"):(a("This video provider is not supported","error"),t.disabled=!1)}catch(e){a(e instanceof Error?e.message:"An error occurred","error"),t.disabled=!1}})),s.addEventListener("click",(async()=>{if(c)try{s.disabled=!0,a("Creating session...","info");const t=await fetch(`${e}/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:c})}),n=await t.json();if(!n.success)throw new Error(n.error?.message||"Failed to create session");r.textContent=n.session.url,o.style.display="block",a("Session created successfully!","success")}catch(e){a(e instanceof Error?e.message:"An error occurred","error"),s.disabled=!1}else a("No URL found","error")})),i.addEventListener("click",(async()=>{try{await navigator.clipboard.writeText(r.textContent||"");const e=i.innerHTML;i.innerHTML='\n                <svg class="icon" viewBox="0 0 24 24">\n                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>\n                </svg>\n                Copied!\n            ',setTimeout((()=>{i.innerHTML=e}),2e3)}catch(e){a("Failed to copy to clipboard","error")}}))}))})();